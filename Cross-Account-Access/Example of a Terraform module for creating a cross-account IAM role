A reusable Terraform module for creating a **cross-account IAM role**. Itâ€™s designed to let one AWS account assume a role in another, with tight control over permissions and trust relationships.

---

### ğŸ“¦ Module Structure

modules/
â””â”€â”€ cross_account_role/
    â”œâ”€â”€ main.tf          # Core resources: IAM role, trust policy, attachments
    â”œâ”€â”€ variables.tf     # Input variables for role name, policies, tags, etc.
    â””â”€â”€ outputs.tf       # Outputs like role ARN

root/
â”œâ”€â”€ main.tf              # Module instantiation and other resources
â”œâ”€â”€ variables.tf         # Root-level variables (e.g., account IDs, environment)
â””â”€â”€ terraform.tfvars     # Variable values for a specific environment


Letâ€™s say your module lives in `modules/cross_account_role/`. It includes:

#### `main.tf`
```hcl
resource "aws_iam_role" "cross_account" {
  name               = var.role_name
  assume_role_policy = data.aws_iam_policy_document.trust.json
  tags               = var.tags
}

data "aws_iam_policy_document" "trust" {
  statement {
    effect = "Allow"

    principals {
      type        = "AWS"
      identifiers = [var.trusted_principal_arn]
    }

    actions = ["sts:AssumeRole"]
  }
}

resource "aws_iam_role_policy_attachment" "policy_attachment" {
  count      = length(var.policy_arns)
  role       = aws_iam_role.cross_account.name
  policy_arn = var.policy_arns[count.index]
}
```

#### `variables.tf`
```hcl
variable "role_name" {
  description = "Name of the IAM role"
  type        = string
}

variable "trusted_principal_arn" {
  description = "ARN of the trusted principal (e.g., another account's IAM role)"
  type        = string
}

variable "policy_arns" {
  description = "List of policy ARNs to attach to the role"
  type        = list(string)
  default     = []
}

variable "tags" {
  description = "Tags to apply to the role"
  type        = map(string)
  default     = {}
}
```

#### `outputs.tf`
```hcl
output "role_arn" {
  value = aws_iam_role.cross_account.arn
}
```

---

### ğŸš€ Example Usage

In your root module or environment-specific repo:

```hcl
module "ci_cd_cross_account_role" {
  source               = "./modules/cross_account_role"
  role_name            = "ci-cd-deploy-role"
  trusted_principal_arn = "arn:aws:iam::123456789012:role/github-actions-runner"
  policy_arns          = [
    "arn:aws:iam::aws:policy/AmazonS3FullAccess",
    "arn:aws:iam::aws:policy/AWSCodeDeployFullAccess"
  ]
  tags = {
    Environment = "prod"
    Team        = "devops"
  }
}
```

---

This setup gives you:
- ğŸ” Tight control over who can assume the role
- ğŸ“š Modular policy attachment
- ğŸ·ï¸ Tagging for governance and cost tracking

